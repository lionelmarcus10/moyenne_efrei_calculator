let Efrei_Modules = {
  "semestre 4": {
    "Formation générale": {
      "Dissertation et Rhétorique": {
        "CE": 0.2,
        "DE": 0.5,
        "Projet": 0.3
      },
      "Economie": {
        "DE": 0.7,
        "NOTE": 0.3
      },
      "English 4 - Preparation for the Study Abroad Program": {
        "CE": 0.2,
        "CO": 0.2,
        "DE": 0.4,
        "TD20": 0.2
      },
      "Learning XP": {
        "NOTE": 1
      }
    },
    "UE - Informatique générale": {
      "Introduction aux Bases de Données": {
        "DE": 0.6,
        "TD": 0.2,
        "TP": 0.2
      },
      "Programmation Oriente Objet en java": {
        "DE": 0.6,
        "TD": 0.2,
        "TP": 0.2
      },
      "Programmation Web": {
        "DE": 0.5,
        "PRJ": 0.3,
        "TP": 0.2
      }
    },
    "UE - Mathématiques": {
      "Analyse de données": {
        "CE": 0.4,
        "DE": 0.6
      },
      "Automates finis et expressions rationnelles": {
        "DE": 0.4,
        "PRJ": 0.4,
        "TD": 0.2
      },
      "Modélisation mathématique": {
        "CTP": 0.2,
        "DE": 0.6,
        "PRJ": 0.2
      }
    },
    "UE - Physique et électronique": {
      "Propagation électromgnétique": {
        "DE": 0.6,
        "TAI": 0.1,
        "TD": 0.3
      },
      "Systèmes de transmission": {
        "CTD": 0.2,
        "DE": 0.6,
        "PRJ": 0.2,
        "TP": 0
      },
      "Thermodynamique": {
        "DE": 0.6,
        "TAI": 0.1,
        "TD": 0.3
      }
    },
    "UE -Projet Transverse": {
      "Projet transverse L2": {
        "PRJ": 1
      }
    },
    "UE -Stage L2": {
      "Stage commercial": {
        "": 2
      }
    }
  },
  "semestre 3": {
    "UE -Formation générale": {
      "Dissertation et critique d'un essai": {
        "CE": 0.2,
        "DE": 0.5,
        "PRJ": 0.3
      },
      "Englhish 3 - Scientific and Technical English": {
        "CE": 0.2,
        "CO": 0.2,
        "DE": 0.4,
        "TD20": 0.2
      },
      "Introduction au Delivery de projet": {
        "TP": 1
      },
      "Learnig XP": {
        "NOTE": 1
      },
      "Révolution numérique et entrepreneuriat": {
        "NOTE": 1
      }
    },
    "UE -Informatique générale": {
      "Algorithmique et structure de données 2": {
        "DE": 0.5,
        "PRJ": 0.15,
        "TD": 0.2,
        "TP": 0.15
      },
      "Architecture réseaux": {
        "DE": 0.6,
        "TD": 0.4,
        "TP": 0
      },
      "Introduction au système Linux": {
        "CTP": 0.4,
        "DE": 0.6
      }
    },
    "UE - Mathématiques": {
      "Fonctions de plusieurs variables": {
        "CTD": 0.4,
        "DE": 0.6
      },
      "Introduction à Matlab": {
        "DE": 0.6,
        "TP": 0.4
      },
      "Probabilités": {
        "CE": 0.4,
        "DE": 0.6
      }
    },
    "UE - Physique et électronique": {
      "Champs électromagnétiques": {
        "DE": 0.6,
        "TD": 0.4
      },
      "Physique moderne": {
        "DE": 0.6,
        "TD": 0.4
      },
      "Systèmes numériques": {
        "CTD": 0.1,
        "DE": 0.6,
        "PRJ": 0.1,
        "TP": 0.2
      }
    }
  },
  "semestre 2": {
    "UE - Formation générale": {
      "English 2 - Issues in the English Speaking World": {
        "CE": 0.2,
        "CO": 0.2,
        "DE": 0.4,
        "TD20": 0.2
      },
      "Essai et écriture créative": {
        "CE": 0.2,
        "DE": 0.4,
        "PRJ": 0.4
      },
      "Histoire des Sciences": {
        "CE": 1
      },
      "Participation à la vie de l'école": {
        "NOTE": 1
      }
    },
    "UE - Informatique": {
      "Algorithmique et structures de données 1": {
        "CE": 0.2,
        "DE": 0.4,
        "PRJ": 0.15,
        "TD": 0.1,
        "TP": 0.15
      },
      "Introduction à GIT": {
        "PRJ": 0.5,
        "TP": 0.5
      }
    },
    "UE - Physique et électronique": {
      "De l'atome à la puce": {
        "DE": 0.6,
        "TAI": 0.1,
        "TD": 0.3
      },
      "Du système à la fonction": {
        "CTD": 0.1,
        "DE": 0.6,
        "PRJ": 0.1,
        "TP": 0.2
      },
      "Electricité générale": {
        "DE": 0.6,
        "TD": 0.2,
        "TP": 0.2
      }
    },
    "UE - Projet Transverse L1": {
      "Projet transverse": {
        "PRJ": 1
      }
    },
    "UE - Stage L1": {
      "Stage d'exécution": {
        "NOTE": 1
      }
    }
  },
  "semestre 1": {
    "UE - Formation générale": {
      "Analyse argumentative et communication orale": {
        "CE": 0.2,
        "DE": 0.5,
        "TD20": 0.3
      },
      "English 1 - Technology and Society": {
        "CE": 0.2,
        "CO": 0.2,
        "DE": 0.4,
        "TD20": 0.2
      },
      "Participation à la vie de l'école": {
        "NOTE": 1
      }
    },
    "UE - Informatique": {
      "Algorithmique": {
        "CE": 0.3,
        "DE": 0.5,
        "TD": 0.2
      },
      "Programmation en Python": {
        "CE": 0.3,
        "DE": 0.3,
        "PRJ": 0.2,
        "TP": 0.2
      }
    },
    "UE - Mathématiques": {
      "Algèbre générale": {
        "CE": 0.2,
        "CTD": 0.4,
        "DE": 0.4
      },
      "Analyse 1": {
        "CE": 0.2,
        "DE": 0.4,
        "TD": 0.4
      }
    },
    "UE - Physique et électronique": {
      "Information numérique": {
        "CTD": 0.2,
        "DE": 0.5,
        "TP": 0.3
      },
      "Matière et ondes": {
        "DE": 0.6,
        "TD": 0.4
      },
      "Mécanique et électricité": {
        "DE": 0.6,
        "TD": 0.4
      }
    }
  }
};


// Récupérer le contexte du canvas
var RadarGraph = document.getElementById('RadarChart').getContext('2d');

// creer un graphique de type radar vide
var mychart2 = new Chart(RadarGraph, {
    type: 'radar',
    data: {
        labels: ["UE 1", "UE 2", "UE 3", "UE 4"],
        datasets: [{
          label: 'Un graphique de mes résultats/performances en temps réel',
          data: [],
          fill: true,
          backgroundColor: 'rgba(54, 162, 235, 0.2)',
          borderColor: 'rgb(54, 162, 235)',
          pointBackgroundColor: 'rgb(54, 162, 235)',
          pointBorderColor: '#fff',
          pointHoverBackgroundColor: '#fff',
          pointHoverBorderColor: 'rgb(54, 162, 235)'
        }]
      },
    // Configuration des options du graphique avec un interval de 0 à 20 à pas de 5 
    options: {
      scales: {
        r: {
          min: 0,  
          max: 20,
          stepSize: 5 
        }
      }
    }
  })



// sommer une liste de nombres
function sommeListe(liste) {
  let somme = 0;
  for (let i = 0; i < liste.length; i++) {
    somme += liste[i];
  }
  return somme;
}

// avoir les données d'un semestre en fonction de son numéro
function getSemesterByNumber(number){
  return  Efrei_Modules[`semestre ${number}`];
}

// avoir le nom de tous les UE d'un semestre en fonction de son numéro
function getSemesterUeNames(Semester_Number){
  let UE = Object.keys(getSemesterByNumber(Semester_Number));
  
  return UE;
}

// avoir le nom de tous les modules d'un UE en fonction du nom de l'UE et du numéro du semestre
function getSemesterUeModuleNames(Semester_Number, UE_Name){
  let Modules = Object.keys(Efrei_Modules[`semestre ${Semester_Number}`][UE_Name]);
  
  return Modules;
}

// avoir les differents types d'activités d'un module ainsi que leur coefficient en fonction du nom de l'UE, du nom du module et du numéro du semestre
function getSemesterUeModuleStepsAndQuota(Semester_Number, UE_Name, Module_Name){
  let Module = Efrei_Modules[`semestre ${Semester_Number}`][UE_Name][Module_Name];
  return Module;
}




// Fonction pour afficher le tableau selon le semestre sélectionné
function afficherTableau(semestre) {
  
  let UE = getSemesterUeNames(semestre);
  // Récupérer l'élément du tableau par son ID
  var table = document.getElementById("myTable");

  // Effacer le contenu du tableau
  table.innerHTML = "";
  // changger le label du graphique radar avec les noms des UE du semestre
  mychart2.data.labels = UE
  // creer une liste pour stocker les moyennes des UE du semestre
  let UE_list = Array(UE.length).fill(0);
  // changer les données du graphique radar avec les moyennes des UE du semestre
  mychart2.data.datasets[0].data = UE_list;
  // mettre à jour le graphique radar
  mychart2.update()
  // creer une ligne pour la moyenne générale avec une classe General
  last_line = document.createElement("tr");
  last_line.classList.add("General");
  // creer 2 colonnes pour la moyenne générale pour le texte et la valeur de la moyenne générale
  last_line.innerHTML = "<td colspan='4'> Moyenne générale </td><td id='General-mean'>0</td>";

  // Parcourir les matières du semestre et ajouter les lignes correspondantes au tableau
  for (let i =0;  i < UE.length ; i++) {
    let Modules = getSemesterUeModuleNames(semestre, UE[i]);
    // creer une ligne pour l'UE avec une classe UE 
    let UE_Row = document.createElement("tr");
    UE_Row.classList.add("UE");

    let UE_Name = document.createElement("td");
    let UE_moyenne = document.createElement("td");
    UE_moyenne.classList.add("UE-moyenne");
    UE_Name.innerHTML = UE[i];
    UE_Row.appendChild(UE_Name);
    UE_Row.classList.add("UE-Name");
    UE_Name.colSpan = 4;
    UE_Name.style.textAlign = "left";
    UE_Row.appendChild(UE_moyenne);
    // creer une liste pour stocker les moyennes des modules de l'UE
    let Modules_list = Array(Modules.length).fill(0);

    UE_moyenne.innerHTML = 0;
    table.appendChild(UE_Row);

    // creer un proxy pour mettre à jour la moyenne de l'UE à chaque fois qu'on met à jour la moyenne d'un module ou une note    
    const proxyModules_list = new Proxy(Modules_list, {
      set(target, property, value) {
        target[property] = value;
        sum = sommeListe(target);
        sum = Math.round(sum * 100) / 100
        target[-1] = sum/Modules.length;
        UE_moyenne.innerHTML = target[-1];
        UE_list[i] = target[-1];
        // calculer la moyenne générale , la mettre dans une variable 
        // coeffcient_final sommeListe(coefficient)
        //let General_mean = / coefficient_final;
        // utiliser la variable
        //document.getElementById("General-mean").innerHTML = General_mean;
        mychart2.data.datasets[0].data = UE_list;
        mychart2.update()
        return true;
      },
    });

    

    for(let j = 0; j < Modules.length; j++){

      // creation de la ligne avec tr
      let matiereUE_Row = document.createElement("tr");
      // creation de la cellule avec td
      let matiereUE_Name = document.createElement("td");
      // ajout du nom de la matiere dans la cellule
      matiereUE_Name.innerHTML = Modules[j];
      // ajout des classes
      matiereUE_Row.classList.add("UE-module");
      matiereUE_Name.classList.add("UE-module-Name");
      // ajout du colspan pour que la cellule prenne 2 colonnes
      matiereUE_Name.colSpan = 2
      // alignement du texte au centre
      matiereUE_Name.style.textAlign = "center";
      // ajout de cellules dans la ligne
      matiereUE_Row.appendChild(document.createElement("td"));
      matiereUE_Row.appendChild(matiereUE_Name);
      matiereUE_Row.appendChild(document.createElement("td"));
      let module_moy = document.createElement("td")
      matiereUE_Row.appendChild(module_moy);
      // ajout de la ligne dans le tableau
      table.appendChild(matiereUE_Row);

      // refaire une boucle pour les types coeff moyenne
      let Module_Steps = Object.keys(getSemesterUeModuleStepsAndQuota(semestre, UE[i], Modules[j]));
      // creer une liste pour stocker les notes de chaque module
      const list_notes = Array(Module_Steps.length).fill(0);
      // creer un proxy pour intercepter les modifications et agir sur les autres zones du tableau en conséquence
      const proxyListNotes = new Proxy(list_notes, {
        set(target, property, value) {
          target[property] = value;
          sum = sommeListe(target);
          // calcul de la moyenne des notes du module
          sum = Math.round(sum * 100) / 100
          target[-1] = sum;
          module_moy.innerHTML = sum;
          proxyModules_list[j] = sum;
          return true;
        },
      });

      for(let v=0; v < Module_Steps.length;v++){
        // creer une ligne pour les steps avec une classe Module-Type
        let Module_Steps_Row = document.createElement("tr");
        Module_Steps_Row.classList.add("Module-Type");
        
        // creer une cellule pour le type avec une classe Module-Type-Name
        let Module_Steps_Name = document.createElement("td");
        Module_Steps_Name.innerHTML = Module_Steps[v];
        Module_Steps_Name.classList.add("Module-Type-Name");
        Module_Steps_Row.appendChild(document.createElement("td"));
        Module_Steps_Row.appendChild(document.createElement("td"));
        Module_Steps_Row.appendChild(Module_Steps_Name);
        // mettre les deux colonnes coeff et moyenne input
        let coeff = document.createElement("td")
        coeff.innerHTML = getSemesterUeModuleStepsAndQuota(semestre, UE[i], Modules[j])[Module_Steps[v]];
        Module_Steps_Row.appendChild(coeff);
        let moyenne = document.createElement("td")
        let input = document.createElement("input");
        input.setAttribute("type", "number");
        input.setAttribute("min", 0);
        input.setAttribute("max", 20);

        // ajouter un event listener pour mettre à jour la liste des notes du module à chaque changement de valeur
        input.addEventListener("input", ()=> {proxyListNotes[v] = (input.value * coeff.textContent);} )
        moyenne.appendChild(input);
        Module_Steps_Row.appendChild(moyenne);
        table.appendChild(Module_Steps_Row);
        
      }
      
    }
    
  }
  // ajouter la ligne de moyenne générale à la fin du tableau
  table.appendChild(last_line);
  
  
}

